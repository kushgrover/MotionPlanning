\section{Introduction}

%Sampling-based motion planning is a well-developed area with plenty of applications \todo{cite some survey} and techniques available, for instance, RRT, RRG \todo{list and cite relevant stuff}.

Motion planning with Linear Temporal Logic (LTL) mission specifications aims for consideration of richer objectives than the traditional A-to-B motion planning. Examples of such objectives include periodic surveillance, request-response, or sequencing. Successful approaches to the problem range from using various cell decomposition techniques, to creating roadmaps abstracting the environment and to sampling-based motion planning. Motion planning with LTL missions is, however, much more challenging in \emph{a priori} unknown environments: efficient treatment of LTL specifications may require exploiting semantic and spatio-temporal dependencies between features of the environment, which are typically unknown beforehand. As an example, consider that we would like a robot to check all waste bins in all offices in an office environment. When finding the first bin, the robot may realize it was next to a desk. While looking for the bin in the next office, it is most natural that the robot starts exploring again next to the desk. At the same time, due to the potential complexity of the environment, it is not desirable to stick fully to all of the observed semantic and spatio-temporal correlations as not all of them are relevant for the specification satisfaction.

%However, techniques tailored or even just applicable to the setting with rich specifications, such as formulae of Linear Temporal Logic (LTL) are scarce \todo{I'm not sure about it (for LTL motion planning there is probably plenty, but sampling-based? if still plenty then we'd restrict already here to partially known labellings); cites}.
%The difficulties arising due to rich logical specifications are twofold.
%Firstly, it is hard to find a satisfying path by a simple random exploration of the state space.
%Indeed, a very particular (and thus rare order) of events may be required, followed by an infinite repetition of its (possibly non-trivial) modifications as the plan does not depend on the current state only but also on the history.
%Secondly, efficient treatment of specifications in temporal logic may require exploiting semantic and spatio-temporal dependencies between atomic propositions, which are typically unknown.
%Moreover, even if there is some domain knowledge or learnt experience, it is hard to reflect.

%\begin{example*}

% As an example, consider an LTL goal specification $\F(\mathit{living\_room}\wedge\F \mathit{kitchen}) \wedge \F\mathit{kitchen}$ expressing that   

% encoding a sequence of, e.g., collecting A and then B (B's before A do not count), and a property $\psi=\F c$. % $\psi=\F(d\wedge \F e)$ for switching off the collector and then switching off entirely.
% For the specification $\varphi\wedge\psi$, it might seem sensible to take $c$ if the opportunity occurs, so that we make progress w.r.t.~$\psi$.
% However, we might experimentally observe that we see no $a$'s and $b$'s occur after $c$ (for instance since $c$ denotes switching off the collector), while otherwise $b$'s are frequent if no $c$ is taken.
% As a consequence of this learnt conjecture, we might rather counter-intuitively postpone any progress with $c$, wait for an $a$, then take the abundant $b$ and only afterwards take $c$.
% While such a plan might be still discovered by random trials, if the sequences are longer then we need this kind of learning and reasoning to get reasonably high chance thereof.
% %\end{example}

In this paper, we focus on sampling-based motion planning with missions specified with the syntactically co-safe fragment of LTL (scLTL), and with the robot deployed in \emph{a priori} unknown environments.
%we address both difficulties in the setting of sampling-based motion planning with LTL specifications where, moreover, the atomic-proposition labelling may not be completely known for the whole state space upfront, but only for some sensing radius.
The key idea of our approach is, on the conceptual level, to make the sampling \emph{guided} by a semantic abstraction of the system and by the specification. 
%moreover, \emph{in connection to the system}.
%In our example, the property might guide us to take $c$ since we are waiting for it, but the achieved knowledge of the system w.r.t.\ this property dissuades us from doing so.
The overview of our algorithm is depicted in Fig.~\ref{fig:guide}. We extend the RRG algorithm with learning and biasing; we iteratively learn a semantic abstraction of the system from the gradually growing RRG graph and compose it with an automaton representation of the specification into a so-called product. The product is used to bias sampling in RRG, i.e. to exploit the semantic and spatio-temporal dependencies of features in the environment as well as their relation to satisfying the desired specification.

%On the technical level, we \texttt{learn} a %\emph{semantic abstraction of the system}  and use its \emph{product with the property automaton} to \texttt{bias} further sampling.
%The states of the semantic abstraction reflect (only) the logical validity of \todo{atomic propositions}; its transitions are learnt from the samples, which are anyway generated in the RRG-based planning.



% \begin{figure}
%     \centering
%     \includegraphics[scale=0.6]{scheme}
%     \caption{Guidance scheme \todo{think of a good way to draw this}}
%     \label{fig:scheme}
% \end{figure}
\input{figures/guidance_scheme}

%The specification is thus exploited twice to improve the guidance: (1) We reflect the property itself. (2) We can build the product and reflect the particularities of the (unknown) system \emph{behaviour with respect to the property}.

Compared to the naive two-step approach, which first explores the environment and then plans a trajectory that satisfies the mission, our approach (i) performs both tasks at once and, moreover, (ii) allows mutual exchange of information between the two tasks. 
We show that these two improvements shorten the length of the executed path significantly.
We achieve this while maintaining similar computation time, which will, in reality, be negligible as the robot can execute the algorithm in real-time while navigating in the environment.
Our contribution can be summarized as follows:
\begin{itemize}
    \item We propose a method to learn a semantic abstraction of the system, suitable for planning with scLTL missions. 
    \item We exploit the learned semantic abstraction and, together with consideration of the specification, we bias the growth of the RRG graph towards promising regions (in terms of making progress towards the specification satisfaction).
    \item We experimentally show that the loop between sampling and learning leads to better planning in terms of shorter trajectories when compared to the naive two-step approach. The results indicate more than $50\%$ savings.
    %, and (2) more goal-oriented and thus more explainable plans.
\end{itemize}



The paper is organized as follows. Sec.~\ref{sec:related} introduces relevant related work, and Sec.~\ref{sec:prel} describes preliminary tools needed for the remainder of the paper. The problem is formally defined in Sec.~\ref{sec:prob}, which is followed by the proposed solution and analysis in Sec.~\ref{sec:sol}. Lastly, a case study is presented in Sec.~\ref{sec:cases}, with conclusions and future work in Sec.~\ref{sec:conclusion}.


%\todo{Mention somewhere that partitioning according APs is a very simple semantic abstraction -- tells us only where interesting properties are and how they neighbor with each other}

\subsection{Related Work} \label{sec:related}
One of the first works to propose the use of a sampling-based motion planning algorithm to find a trajectory that satisfies a temporal logic specification is \cite{karaman2009sampling}. In that work, the authors propose the Rapidly-exploring Random Graph (RRG) as an alternative to the Rapidly-exploring Random Tree (RRT) to finding cyclic trajectories that satisfy a deterministic $\mu$-calculus specification. Another approach is presented in \cite{bhatia2010sampling}, but this time for the syntactically co-safe fragment of Linear Temporal Logic (scLTL). Following these, \citet{vasile2013sampling} propose improvements to \cite{karaman2009sampling}, more specifically for dealing with full LTL and for improving scalability. None of these works, however, deals with partially-known environments, nor do they attempt to speed up the search by learning characteristics of the environment.

More recently, \citet{kantaros2018sampling} described an approach for multi-robot systems under global temporal tasks. Instead of using an RRG, the authors propose a two-step approach using RRT$^\star$. The first step constructs a tree until an accepting state of the automaton capturing the evolution of the LTL formula is reached. The second step then grows another tree rooted at this accepting state, and attempts to find a cyclic (infinite) path that satisfies the LTL specification. The same authors then introduce in \cite{kantaros2020stylus} sampling bias guided by the automaton capturing the LTL, something that \cite{luo2019abstraction} also proposes in a similar fashion. Lastly, besides proposing a heuristic to guide the search, \cite{tajvar2020safe} integrates feedback control laws to guarantee feasibility of plans by robots with complex, possibly non-holonomic, dynamics. Although these works propose ways of improving the time taken to find a plan, they all rely on having details of the environment a priori.

To the best of our knowledge, the two papers that are mostly related to ours are \cite{kantaros2020reactive} and \cite{ayala2013temporal}. The former proposes a reactive sampling-based algorithm for path planning in unknown environments under scLTL specifications. However, differently from what we propose, only the obstacle space is initially unknown to \cite{kantaros2020reactive}, i.e. the locations of the regions of interest, therefore the labeling function, are {known} a priori. On the other hand, \citet{ayala2013temporal} considers completely unknown environments, including the labeling function. However, the authors propose an approach over a discretized partitioning of the environment, performing frontier exploration \cite{yamauchi1997frontier} until a path that satisfies the scLTL specification is found. We merge benefits of both approaches by proposing a sampling-based approach on completely unknown environments; furthermore, we propose a way of learning relations between labels, together with exploiting them for guiding the path search.


When it comes to robotic deployment in unknown environments, a crucial initial step might be to efficiently create a map in an exploratory manner. A seminal work on exploration is by \citet{yamauchi1997frontier}, in which the author proposes the method coined \emph{frontier exploration}. Since then, several other approaches have been proposed. Among them is the Receding Horizon Next-Best-View Planner \cite{bircher2016receding} and the Autonomous Exploration Planner \cite{selin2019efficient}, both building upon RRT$^\star$. These works, however, do not focus on capturing various dependencies and relations in the environment. In  contrast, in a probabilistic approach proposed by \citet{aydemir2013active}, a robot uses common-sense knowledge about the relation between objects and semantic room categories. Here, the focus is however on search for objects and not satisfaction of complex LTL goals. 
%These approaches can be used as fallback cases in our algorithm; i.e. when our approach still does not have enough information to bias the growth of the RRG graph, it need to take a step towards exploring the space in a promising direction.
